<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Contingency Planning Tool</title>
  <style>
    /* Global Container */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      font-family: Arial, sans-serif;
    }

    /* Header Section */
    .header-section {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 20px;
      margin-bottom: 30px;
      align-items: start;
    }
    .header-section label {
      font-weight: bold;
      margin-bottom: 5px;
      display: block;
    }
    .header-section input,
    .header-section textarea {
      width: 100%;
      padding: 8px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    /* Tabs Navigation */
    .tabs {
      display: flex;
      border-bottom: 2px solid #ccc;
      margin-bottom: 20px;
    }
    .tabs button {
      background-color: #f7f7f7;
      border: none;
      border-top-left-radius: 4px;
      border-top-right-radius: 4px;
      padding: 12px 20px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: background-color 0.3s;
      margin-right: 2px;
    }
    .tabs button:hover {
      background-color: #e2e2e2;
    }
    .tabs button.active {
      background-color: #fff;
      border-bottom: 2px solid #fff;
    }

    /* Tab Content */
    .tab-content {
      display: none;
      animation: fadeIn 0.3s;
    }
    .tab-content.active {
      display: block;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* Table Styling */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 15px;
    }
    th, td {
      border: 1px solid #aaa;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #f0f0f0;
    }

    /* Button Groups */
    .button-group {
      margin-bottom: 30px;
      text-align: right;
    }
    .button-group button {
      padding: 8px 12px;
      margin: 5px 2px;
      font-size: 14px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background-color: #007BFF;
      color: #fff;
      transition: background-color 0.3s;
    }
    .button-group button:hover {
      background-color: #0056b3;
    }

    /* Contingency Planning Life Cycle Section */
    .risk-treatment {
      margin-bottom: 30px;
    }
    .risk-treatment textarea {
      width: 100%;
      padding: 10px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
    }

    /* Footer Styling */
    .footer-section {
      text-align: right;
      font-weight: bold;
      font-size: 14px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header: Assessor and Risk Assessment Description -->
    <div class="header-section">
      <div>
        <label for="assessor">Assessor:</label>
        <input type="text" id="assessor" placeholder="Enter assessor name">
      </div>
      <div>
        <label for="assessmentDesc">Description of Risk Assessment:</label>
        <textarea id="assessmentDesc" rows="5" placeholder="Enter assessment description"></textarea>
      </div>
    </div>

    <!-- Tabs Navigation -->
    <div class="tabs">
      <button class="tablinks active" onclick="openTab(event, 'cpmt')">CPMT</button>
      <button class="tablinks" onclick="openTab(event, 'bia')">Business Impact Analysis</button>
      <button class="tablinks" onclick="openTab(event, 'weighted')">Weighted Business Process Ranking</button>
      <button class="tablinks" onclick="openTab(event, 'teams')">Subordinate Planning Teams</button>
    </div>

    <!-- Tab Contents -->
    <!-- Tab 1: CPMT -->
    <div id="cpmt" class="tab-content active">
      <h2>CPMT</h2>
      <table id="cpmtTable">
        <thead>
          <tr>
            <th>CPMT Role</th>
            <th>Name</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="button-group">
        <button onclick="addRow('cpmtTable', ['', ''])">Add Row</button>
        <button onclick="deleteRow('cpmtTable')">Delete Row</button>
        <button onclick="saveData('cpmtTable', 'cpmt.csv')">Save Data</button>
      </div>
    </div>

    <!-- Tab 2: Business Impact Analysis -->
    <div id="bia" class="tab-content">
      <h2>Business Impact Analysis</h2>
      <table id="biaTable">
        <thead>
          <tr>
            <th>Business Process</th>
            <th>Potential Impacts</th>
            <th>Max Tolerable Downtime</th>
            <th>System Components</th>
            <th>Recovery Time Objective</th>
            <th>Confidentiality (FIPS 199)</th>
            <th>Integrity (FIPS 199)</th>
            <th>Availability (FIPS 199)</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="button-group">
        <button onclick="addRow('biaTable', ['', '', '', '', '', '', '', ''])">Add Row</button>
        <button onclick="deleteRow('biaTable')">Delete Row</button>
        <button onclick="saveData('biaTable', 'business_impact_analysis.csv')">Save Data</button>
      </div>
    </div>

    <!-- Tab 3: Weighted Business Process Ranking -->
    <div id="weighted" class="tab-content">
      <h2>Weighted Business Process Ranking</h2>
      <table id="weightedTable">
        <thead>
          <tr>
            <th>Business Process</th>
            <th>Impact on Profitability</th>
            <th>Contribution to Strategic Objectives</th>
            <th>Impact on Internal Operations</th>
            <th>Impact on Public Image</th>
            <th>Total Weighted Score</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="button-group">
        <button onclick="addRow('weightedTable', ['', '', '', '', '', ''])">Add Row</button>
        <button onclick="deleteRow('weightedTable')">Delete Row</button>
        <button onclick="calculateWeightedScores()">Calculate</button>
        <button onclick="saveData('weightedTable', 'weighted_business_process_ranking.csv')">Save Data</button>
      </div>
    </div>

    <!-- Tab 4: Subordinate Planning Teams -->
    <div id="teams" class="tab-content">
      <h2>Subordinate Planning Teams</h2>
      <table id="teamsTable">
        <thead>
          <tr>
            <th>Team</th>
            <th>Team Member 1</th>
            <th>Team Member 2</th>
            <th>Team Member 3</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="button-group">
        <button onclick="addRow('teamsTable', ['', '', '', ''])">Add Row</button>
        <button onclick="deleteRow('teamsTable')">Delete Row</button>
        <button onclick="saveData('teamsTable', 'subordinate_planning_teams.csv')">Save Data</button>
      </div>
    </div>

    <!-- Contingency Planning Life Cycle Section -->
    <div class="risk-treatment">
      <h2>Contingency Planning Life Cycle:</h2>
      <textarea id="riskTreatment" rows="10" placeholder="Enter contingency planning life cycle details"></textarea>
    </div>

    <!-- Footer -->
    <div class="footer-section">
      Conceptualized and Designed by Dr. Ashraf
    </div>
  </div>

  <script>
    // ----- Tab Switching -----
    function openTab(evt, tabName) {
      const tabContents = document.getElementsByClassName("tab-content");
      const tabButtons = document.getElementsByClassName("tablinks");
      for (let content of tabContents) {
        content.classList.remove("active");
      }
      for (let btn of tabButtons) {
        btn.classList.remove("active");
      }
      document.getElementById(tabName).classList.add("active");
      evt.currentTarget.classList.add("active");
    }

    // ----- Utility Functions -----
    function addRow(tableId, defaultValues) {
      const tableBody = document.getElementById(tableId).querySelector('tbody');
      const row = tableBody.insertRow();
      defaultValues.forEach((val, index) => {
        const cell = row.insertCell();
        const input = document.createElement('input');
        input.type = "text";
        input.value = val;
        input.style.width = "100%";
        // For the weighted table, the last column (index 5) is calculated
        if(tableId === 'weightedTable' && index === 5) {
          input.readOnly = true;
        }
        cell.appendChild(input);
      });
    }

    function deleteRow(tableId) {
      const tableBody = document.getElementById(tableId).querySelector('tbody');
      if(tableBody.rows.length > 0) {
        tableBody.deleteRow(-1);
      }
    }

    function prePopulate() {
      const tables = [
        {id: 'cpmtTable', defaults: ['', '']},
        {id: 'biaTable', defaults: ['', '', '', '', '', '', '', '']},
        {id: 'weightedTable', defaults: ['', '', '', '', '', '']},
        {id: 'teamsTable', defaults: ['', '', '', '']}
      ];
      tables.forEach(tableObj => {
        for(let i = 0; i < 5; i++) {
          addRow(tableObj.id, tableObj.defaults);
        }
      });
    }

    // ----- Calculation Functions -----
    function calculateWeightedScore(profitability, strategic, internal, publicImage) {
      return ((profitability * 0.4) + (strategic * 0.3) + (internal * 0.2) + (publicImage * 0.1)).toFixed(2);
    }

    function calculateWeightedScores() {
      const tableBody = document.getElementById('weightedTable').querySelector('tbody');
      for (let i = 0; i < tableBody.rows.length; i++) {
        const cells = tableBody.rows[i].cells;
        const profitability = parseFloat(cells[1].children[0].value);
        const strategic = parseFloat(cells[2].children[0].value);
        const internal = parseFloat(cells[3].children[0].value);
        const publicImage = parseFloat(cells[4].children[0].value);
        if (!isNaN(profitability) && !isNaN(strategic) && !isNaN(internal) && !isNaN(publicImage)) {
          cells[5].children[0].value = calculateWeightedScore(profitability, strategic, internal, publicImage);
        } else {
          alert("Please enter valid numeric values for all fields in Weighted Business Process Ranking.");
          return;
        }
      }
    }

    // ----- Save Data as CSV -----
    function saveData(tableId, filename) {
      let csvContent = "";
      const table = document.getElementById(tableId);
      // Get header row
      const headers = table.querySelectorAll("th");
      let headerArr = [];
      headers.forEach(header => headerArr.push('"' + header.innerText + '"'));
      csvContent += headerArr.join(",") + "\n";
      // Get data rows
      const rows = table.querySelectorAll('tbody tr');
      rows.forEach(row => {
        let rowData = [];
        row.querySelectorAll('td').forEach(cell => {
          rowData.push('"' + cell.children[0].value + '"');
        });
        csvContent += rowData.join(",") + "\n";
      });
      // Create downloadable CSV file
      const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      link.style.display = "none";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      alert("Data saved as " + filename);
    }

    // ----- Disable Paste in Contingency Planning Life Cycle Textarea -----
    document.getElementById("riskTreatment").addEventListener("paste", function(e) {
      e.preventDefault();
      return false;
    });
    document.getElementById("riskTreatment").addEventListener("contextmenu", function(e) {
      e.preventDefault();
      return false;
    });

    // ----- On Load -----
    window.onload = prePopulate;
  </script>
</body>
</html>
